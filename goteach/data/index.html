<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>TEST</title>
	<script>
		function work() {
			var input = document.querySelector("input[type=text]");
			var div = document.querySelector("div.msgs");
			var ws = new WebSocket("ws://"+window.location.host+"/ws");

			input.focus();

			ws.onmessage = function(e) {
				var p = document.createElement("p");
				p.innerHTML = e.data;

				var msgs = document.querySelectorAll("div.msgs p");
				if(msgs.length == 15) {
					msgs[msgs.length-1].remove();
				}
				div.insertBefore(p, div.firstChild);
			}

			input.onkeypress = function(e) {
				if(e.keyCode == 13 && e.target.value.trim() != "") {
					ws.send(e.target.value);
					e.target.value = null;
				}
			}
		}
	</script>
</head>
<body onload="work()">
	<a href="/logout">Logout</a><br />
	<input type="text"><br />
	<div class="msgs">
		{{ range .messages }}
			<p>{{ .Username }}:{{ .Message }}</p>
		{{ end }}
		<span></span>
	</div>
</body>
</html>